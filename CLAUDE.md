# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Hva er dette?

SAMT-BU Dokumentasjon – et Hugo-basert dokumentasjonsnettsted for SAMT-BU-prosjektet
(Samhandling og digitalisering innen oppvekst og utdanning).
Publiseres til GitHub Pages på `https://samt-bu.github.io/samt-bu-docs/`.

## Teknisk oppsett

- **Rammeverk:** Hugo (Go-basert statisk nettstedsgenerator)
- **Tema:** `hugo-theme-samt-bu` (git submodule fra `github.com/samt-bu/hugo-theme-samt-bu`, basert på Docdock/Altinn-tema)
  - Initialiseres ved kloning: `git submodule update --init --recursive`
  - Go-modul (`go.mod`/`go.sum`) styrer også tema-avhengigheten
- **Konfigurasjon:** `hugo.toml` (baseURL, språk, tema, outputs, editURL)
- **Språk:** Tospråklig – norsk bokmål (standard) og engelsk. Innhold i `_index.nb.md` / `_index.en.md`
- **Søk:** Lunr.js med Horsey.js autocomplete (`static/js/search.js`), generert fra Hugo JSON-output
- **Git-info:** `enableGitInfo = true` – sist-endret-datoer hentes fra commit-historikk

### Bygge og forhåndsvise

```bash
hugo server   # Lokal forhåndsvisning på http://localhost:1313/samt-bu-docs/
hugo          # Bygg til public/
hugo -D       # Bygg inkludert utkast (draft: true)

# Produksjonsbygg (brukes av CI)
hugo --gc --minify --baseURL "https://samt-bu.github.io/samt-bu-docs/"
```

CI/CD: GitHub Actions (`.github/workflows/hugo.yml`) bygger og deployer automatisk ved push til `main`. Hugo-versjon i CI: **0.155.3 extended**.

## Filstruktur – det viktigste

```
hugo.toml                          # Hugo-konfigurasjon (baseURL, språk, tema)
content/                           # Alt innhold (Markdown med YAML frontmatter)
  om/                              # «Om» – intro-seksjon (weight 1)
    om-samt-bu/                    # Om SAMT-BU (weight 1)
    om-dette-nettstedet/           # Om dette nettstedet (weight 2)
    hvordan-bidra/                 # Hvordan bidra (weight 3)
  behov/                           # Behov (weight 10)
    use-cases/                     # 19 nummererte use cases (01–19)
    annet/                         # Annet (foreløpig)
  pilotering/                      # Piloter (weight 20)
    pilot-1-arkitektur/
  arkitektur/                      # Arkitektur (weight 30)
    maalbildet/                    # Målbilde (weight 1) – kapabilitetskart, tjenester, applikasjoner, brukerreiser, prosesser, data, moenstre
    veikart/                       # Veikart (weight 2) – samme 7 underkapitler
  loesning/                        # Løsninger (weight 40)
  rammeverk/                       # Rammeverk (weight 50)
    metodikk/                      # Metodikk (weight 30)
    juss/                          # Juss (weight 40)
    styring/                       # Styring (weight 50)
    begrepsapparat/                # Begrepsapparat (weight 10)
    standarder/                    # Standarder (weight 20)
  informasjonsmodeller/            # Informasjonsmodeller (weight 60)
  innsikt/                         # Felles innsikt – lokal placeholder (weight 70)
  teams/                           # Teams (weight 80) – lokalt seksjonshode
    team-architecture/             # ← montert fra Hugo Module team-architecture
  utkast/                          # Utkast og innspill (weight 90) – ← montert fra Hugo Module samt-bu-drafts
    kommuneforlaget/               # Kommuneforlaget (fra samt-bu-org-andre)
      brukstilfelle-analyse/
themes/hugo-theme-samt-bu/         # ⭐ Git submodule – all presentasjonslogikk ligger her
  layouts/partials/
    custom-head.html               # ⭐ HOVEDDELEN – all tilpasset CSS
    topbar.html                    # Header-bar med logo, tittel, Rediger/Edit-knapp
    header.html                    # HTML-skjelett: <head>, <body>, 3-kolonne wrapper
    menu.html                      # Venstre sidebar-navigasjon (hierarkisk meny)
    footer.html                    # Footer med prev/next-nav, GitHub-redigeringslenke, TOC
    footer-content.html            # Footer-innhold (misjonserklæring)
    custom-footer.html             # JS for tema-switcher, edit-switcher og språkvelger
    tema-switcher.html             # Innhold/Content-dropdown (10 seksjoner)
    edit-switcher.html             # Endre/Edit-dropdown (deep-link til Decap CMS)
    lang-switcher.html             # Språkvelger (flaggikoner nb/en)
    search.html                    # Søkefelt-integrasjon
    status-symbol.html             # Slår opp statussymbol fra .Params.status
  layouts/_default/list.html       # Override for listesider
  layouts/shortcodes/              # children.html, header.html, relref.html
static/
  images/SAMT-BU-logo.png          # Logo (vises invertert i header)
  images/nb.svg, en.svg            # Flaggikoner for språkvelger
  js/search.js                     # Lunr.js søkeimplementasjon
  edit/                            # Decap CMS – innholdsredigering
    index.html                     # Norsk portalside («English →»-lenke i header)
    en/index.html                  # Engelsk portalside («Norsk →»-lenke i header)
    docs-nb/, arkitektur-nb/, utkast-nb/     # Norske CMS-portaler (locales: [nb], locale: nb)
    docs-en/, arkitektur-en/, utkast-en/     # Engelske CMS-portaler (locales: [en])
cloudflare-worker/
  oauth-worker.js                  # GitHub OAuth-proxy (deployet på Cloudflare Workers)
i18n/nb.toml, en.toml              # Oversettelser (navSwitcher-etiketter, seksjonstitler, «Sist endret»)
```

## Decap CMS – innholdsredigering

- **Norsk portal:** `https://samt-bu.github.io/samt-bu-docs/edit/`
- **Engelsk portal:** `https://samt-bu.github.io/samt-bu-docs/edit/en/`
- **OAuth-proxy:** Cloudflare Worker `https://samt-bu-cms-auth.erik-hag1.workers.dev`
- **Lokal testing:** `hugo server` + åpne portalen i nettleser → «Work with Local Repository» (`local_backend: true` i config.yml)
- **config.yml-mal:** `backend.name: github`, `repo: SAMT-BU/<repo>`, `branch: main`, `base_url: https://samt-bu-cms-auth.erik-hag1.workers.dev`, `local_backend: true`, `i18n.structure: multiple_files`
- **Header-dropdown («Endre»/«Edit»):** Erstatter gammel statisk knapp. Implementert i `edit-switcher.html`.
  - «Denne siden»/«This page» → deep-link til gjeldende side i riktig portal
  - «Andre valg»/«Other options» → CMS-oversikt (`/edit/` eller `/edit/en/`)
  - **Rutinglogikk (tre grener)** basert på `$dir = path.Dir .File.Path`:
    - `hasPrefix $dir "teams/"` → arkitektur-portal, collection `arkitektur`
    - `eq/hasPrefix $dir "utkast"` → utkast-portal, collection `utkast`
    - alt annet → docs-portal, collection `docs`
  - **Entry-slug:** Full relativ sti inkl. `/_index` (f.eks. `kommuneforlaget/_index`). Rot-sider i moduler bruker `_index` alene. Docs-rot forblir deaktivert (tom slug). URL: `<portal>#/collections/<collection>/entries/<slug>`
  - **Windows-fallgruve:** `.File.Path` bruker backslash – bruk alltid `path.Dir .File.Path` (normaliserer) fremfor rå `.File.Path` for hasPrefix-sjekker
- **Frontmatter-format:** YAML (`---`) – ikke TOML.
- **OBS:** CMS-sesjoner kan legge igjen testinnhold – sjekk `git diff` før push.

### Aktive CMS-portaler

| Mappe | Repo | Språk | Portalkorttittel | CMS-samlingsnavn |
|-------|------|-------|------------------|-----------------|
| `static/edit/docs-nb/` | `SAMT-BU/samt-bu-docs` | nb | Gjeldende dokumentasjon | Sider |
| `static/edit/docs-en/` | `SAMT-BU/samt-bu-docs` | en | Current documentation | Pages |
| `static/edit/arkitektur-nb/` | `SAMT-BU/team-architecture` | nb | Team arkitektur | Team arkitektur |
| `static/edit/arkitektur-en/` | `SAMT-BU/team-architecture` | en | Team architecture | Team architecture |
| `static/edit/utkast-nb/` | `SAMT-BU/samt-bu-drafts` | nb | Innspill og utkast | Innspill og utkast |
| `static/edit/utkast-en/` | `SAMT-BU/samt-bu-drafts` | en | Inputs and drafts | Inputs and drafts |

**NB-portaler har i tillegg:**
- `locale: nb` i `config.yml`
- Inline JS-lokale i `index.html` som oversetter `«Collections» → «Samlinger»` og `«New» → «Ny»`
- Risiko ved Decap-oppgradering dokumentert i [issue #66](https://github.com/SAMT-BU/samt-bu-docs/issues/66)

**Alle portaler har:**
- `sortable_fields: ['weight', 'title']` – sorterer etter Hugo `weight` (matcher sidebar-rekkefølge)

### Legge til ny CMS-portal

1. Opprett mappe `static/edit/<seksjon>-nb/` med:
   - `index.html` (← Portal-lenke → `../` + JS-lokale-blokk for NB)
   - `config.yml` (`locales: [nb]`, `locale: nb`, `repo: SAMT-BU/<repo>`, `sortable_fields: ['weight', 'title']`)
2. Legg til kort i `static/edit/index.html`
3. Gjenta for `-en/` uten `locale: nb` og uten JS-lokale, lenke → `../en/`

## Innholdskonvensjoner

- Alle seksjoner har `_index.nb.md` og `_index.en.md`
- Frontmatter-felter: `id` (UUID, delt mellom nb/en), `weight` (sorteringsrekkefølge), `status`, `draft: true` for upublisert innhold
- **`id`-felt:** UUID v4, samme verdi i `_index.nb.md` og `_index.en.md` for samme side. Aldri endres.
- `editURL` i `hugo.toml` genererer "Rediger på GitHub"-lenker: `https://github.com/SAMT-BU/samt-bu-docs/edit/main/content/`
- **Commit-meldinger skrives på norsk** (se git-historikken for stil)

### Statussymboler for use cases

Symbolet genereres **automatisk** av `status-symbol.html` fra `status`-feltet – **ikke** lagret i `linkTitle`.
Redaktøren trenger kun endre `status:`-feltet:

| Symbol | NB-verdi | EN-verdi |
|--------|----------|----------|
| ◍ | Ny | New |
| ◔ | Tidlig utkast | Early draft |
| ◐ | Pågår | In progress |
| ◕ | Til QA | For QA |
| ⏺ | Godkjent | Approved |
| ⨂ | Avbrutt | Cancelled |

- NB-filer bruker norske verdier, EN-filer bruker engelske verdier.
- `status-symbol.html` håndterer begge språk.
- Kun use case-filer (01–19 under `behov/use-cases/`) har status satt; øvrige sider har blank status.
- Alle use case-filer har en kommentarblokk i frontmatter som viser gyldige verdier.

## Arkitekturbeslutninger

### 3-kolonne layout med uavhengig scroll

Den viktigste arkitekturbeslutningen. Implementert i `custom-head.html` (linje ~268+):

- **Viewport er låst** (`html, body { height: 100%; overflow: hidden }`) – ingen sidescroll
- **Flexbox-kolonnemodell:** header og footer har fast plass, containeren mellom fyller resten
- **Tre kolonner scroller uavhengig:**
  1. **Venstre (#sidebar):** 20% bredde, maks 260px – navigasjonsmeny
  2. **Midten (#body):** flex 1 – innholdsområde
  3. **Høyre (#page-toc):** 18% bredde, maks 240px – innholdsfortegnelse (TOC)
- **Scrollbarer er skjult** (`scrollbar-width: none` + `::-webkit-scrollbar { display: none }`)
- **Scroll-fade:** Gradient-fade plassert ved visuell bunn av sidebar og TOC viser at det er mer innhold under (JS i `footer.html`)
- **Scroll-spy i TOC:** Aktiv seksjon markeres med bold i TOC-kolonnen mens bruker scroller
- **Mobil:** TOC skjules, single-column layout, vanlig sidescroll
- **Collapsible sidebars:** Toggle-knapper i heading-rad (`#toggle-left` / `#toggle-right`) kollapser kolonnen til 0px. Restore-tabs (`#restore-left` / `#restore-right`) er `position: fixed` direkte i `<body>` (i `header.html`). Tilstand lagres i localStorage.

### Header (det mørkeblå feltet)

- Tema-CSS setter `height: 100px; padding-top: 32px` ved ≥768px
- Overstyrt i `custom-head.html` til `height: auto; padding: 13px 0` (~66px total)
- Innholdet er vertikalt midtstilt med `display: flex; align-items: center` (inline i `topbar.html`)
- Inneholder: logo, tittel, tema-switcher, søk, språkvelger, Endre/Edit-dropdown

### Grått mellomrom (header → kolonner)

- Bootstrap-klasser `pt-md-3 pt-lg-5` på containeren overstyres til halve verdier
- `padding-top: 0.5rem` (768px+) og `1.5rem` (992px+)

### CSS-lagmodell

Tre lag der sistnevnte vinner: `designsystem.css` → `theme.css` → `custom-head.html`

### Container-bredde

Utvidet fra standard Bootstrap: `width: 95vw; max-width: 1400px` ved ≥1200px, `1600px` ved ≥1600px

### Innhold/Content-dropdown (`layouts/partials/tema-switcher.html`)

Dropdown i headeren for å navigere direkte til en av de 10 seksjonene.

- **Etikett:** «Innhold» (nb) / «Content» (en) – styrt av i18n-nøkkel `navSwitcherLabel`
- **Aktiv-deteksjon:** `findRE (printf "/%s/" .id) .RelPermalink` – matcher hele URL-segment
- **Titler:** Oversatt via i18n med `.id` som nøkkel, `.title` som norsk fallback
- **Konfigurasjon:** `[[params.navSwitcher]]` i `hugo.toml` – id, title, url, icon
- **Legg til ny seksjon:** Ny `[[params.navSwitcher]]`-blokk i `hugo.toml` + i18n-nøkkel i `nb.toml`/`en.toml`

### Typografi

- Brødtekst: 16px, Helvetica Neue / Helvetica / Arial
- Sidebar: 15px
- TOC: 13px, 2px solid venstre kantlinje
- Kulepunkter: Tett avstand (4px margin), hierarkisk innrykk (disc → circle → square)

## Nåværende status

### Hva er ferdig

- Hugo-oppsett med tema (submodule), tospråklig konfigurasjon, søk
- 3-kolonne layout med uavhengig scroll
- Header med logo, tittel, Innhold/Content-dropdown, søk, språkvelger, Endre/Edit-dropdown (deep-link til Decap)
- Scroll-fade, scroll-spy i TOC, collapsible sidebars med localStorage-persistens
- Barn-liste på seksjonssider (midt- og høyrekolonne)
- «Om» som første seksjon med tre underkapitler
- 10 seksjoner i flat struktur direkte under `content/`
- Hugo Module-integrasjon: team-architecture og samt-bu-drafts montert
- 19 use cases under Behov (inkl. Kommuneforlaget brukstilfelle-analyse)
- Decap CMS med norsk og engelsk portal, tospråklig redigering bekreftet

### Hva gjenstår / pågår

- Fylle inn faktisk innhold i alle seksjoner
- Finjustere responsiv design for mobil/tablet

## Hugo Modules – innholdsmoduler

Innhold fra eksterne repoer monteres inn via Hugo Module-systemet (`go.mod` + `hugo.toml`).

| Modul | Repo | Montert under | Tittel |
|-------|------|---------------|--------|
| `github.com/SAMT-BU/team-architecture` | [team-architecture](https://github.com/SAMT-BU/team-architecture) | `content/teams/team-architecture/` | Team arkitektur |
| `github.com/SAMT-BU/samt-bu-drafts` | [samt-bu-drafts](https://github.com/SAMT-BU/samt-bu-drafts) | `content/utkast/` | Utkast og innspill |

**Konfigurert i `hugo.toml`** under `[module] [[module.imports]]` med `source = "content"` og `target = "content/<sti>/"`.

**Oppdatere en modul** (etter push til modulrepoet):
```bash
hugo mod get github.com/SAMT-BU/samt-bu-drafts@latest
hugo mod get github.com/SAMT-BU/team-architecture@latest
```

**Legge til ny modul:**
1. Opprett repo, `hugo mod init github.com/SAMT-BU/<navn>`, lag `content/_index.nb.md` + `_index.en.md`, push
2. Legg til `[[module.imports]]`-blokk i `hugo.toml`
3. Kjør `hugo mod get github.com/SAMT-BU/<navn>@latest`
4. Verifiser med `hugo`, commit `hugo.toml` + `go.mod` + `go.sum`

**Repo-navnekonvensjon:**
- `samt-bu-`-prefiks = publisert innhold/produkt (montert i nettstedet)
- `team-`-prefiks = interne arbeidsrepoer for team

## Verktøy

- **GitHub CLI (`gh`):** Installert (`winget`), versjon 2.87.2. Autentisert mot GitHub.
  - Ikke i PATH i alle shell-kontekster – bruk full sti: `"/c/Program Files/GitHub CLI/gh.exe"`
  - Eksempel: `"/c/Program Files/GitHub CLI/gh.exe" repo rename nytt-navn --repo org/gammelt-navn`
  - **Slette repos krever ekstra scope:** Kjør `gh auth refresh -h github.com -s delete_repo` og fullfør nettleserflyt før sletting

## Viktige tips for ny sesjon

1. **All tilpasset CSS er i `themes/hugo-theme-samt-bu/layouts/partials/custom-head.html`** – dette er filen du oftest redigerer for layout/styling
2. **Layout-filer redigeres i temaet** (`themes/hugo-theme-samt-bu/`) – commit der, deretter oppdater submodule-peker i samt-bu-docs
3. **Tema-CSS-en har tre lag:** `designsystem.css` → `theme.css` → `custom-head.html` (sistnevnte vinner)
4. **Bygg med `hugo`** for å verifisere at endringer kompilerer uten feil
5. **Inline styles i `topbar.html`** – header-nav har mye inline CSS for flex-layout
6. **Commit-meldinger skrives på norsk** (se git-historikken for stil)
7. **Submodule-oppdatering:** etter commit i temaet, kjør `git add themes/hugo-theme-samt-bu && git commit` i samt-bu-docs
